(function(e,t){"object"===typeof exports&&"object"===typeof module?module.exports=t():"function"===typeof define&&define.amd?define([],t):"object"===typeof exports?exports["vue-flowy"]=t():e["vue-flowy"]=t()})(window,function(){return function(e){var t={};function s(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,s),n.l=!0,n.exports}return s.m=e,s.c=t,s.d=function(e,t,r){s.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},s.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s="+xUi")}({"+xUi":function(e,t,s){"use strict";s.r(t);s("HrLf");var r=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"flowyChart",attrs:{id:e._uid}})},n=[];const o={paddingLeft:10,paddingRight:10,paddingTop:10,paddingBottom:10,rx:0,ry:0,shape:"rect",width:0,height:0};class i{constructor(e,t){this.id=e,this.setOptions(t)}setOptions(e={}){e.label||(e.label=this.id),Object.assign(this,o,e)}setDefaults(){}}const h="\0",a="",d={minLen:1,weight:1,width:0,height:0,labelOffset:10,labelPos:"r"};class l{constructor(e,t,s,r){this.id=e,this.from=t,this.to=s,this.order=0,this.points=[],this.setOptions(r)}static generateId(e,t,s=!1){if(!s&&e>t){const s=e;e=t,t=s}return e+a+t+a+h}setOptions(e){Object.assign(this,d,e)}}class c{constructor(e){this.graph=e,this.runLayout(),console.log("new layout for graph",e)}runLayout(){this.makeSpaceForEdgeLabels(),this.createNestingGraph(),this.rank(),this.cleanupNestingGraph(),this.order(),this.position(),this.translateGraph()}makeSpaceForEdgeLabels(){this.graph.rankSep/=2,console.log(this.graph),this.graph.edges.forEach(e=>{console.log("making space for edge",e),e.minLen*=2,"c"!==e.labelPos.toLowerCase()&&("TB"===this.graph.rankDir||"BT"===this.graph.rankDir?e.width+=e.labelOffset:e.height+=e.labelOffset)})}createNestingGraph(){console.log("creating nesting graph"),this.graph.root=this.graph.setNode("_root",{dummy:"root"});const e=this.treeDepths();console.log("depths",e);const t=Math.max(...Object.values(e))-1,s=2*t+1;this.graph.edges.forEach(e=>{e.minLen*=s});const r=this.graph.edges.reduce((e,t)=>e+t.weight,0);this.graph.getChildren().forEach(n=>{console.log("calling dfs with",this.graph.root,s,r,t,e,n),this.dfs(this.graph.root,s,r,t,e,n)}),this.graph.nodeRankFactor=s}cleanupNestingGraph(){this.graph.removeNode(this.graph.root.id),this.graph.root=null,this.graph.edges.forEach(e=>{e.nestingEdge&&this.graph.removeEdge(e.id)})}treeDepths(){const e={},t=this;function s(r,n=1){const o=t.graph.getChildren(r);console.log("children of",r,"are",o,". depth:",n),o&&o.length&&o.forEach(e=>{console.log("child",e),s(e,n+1)}),e[r]=n}return this.graph.getChildren().forEach(e=>{s(e)}),e}dfs(e,t,s,r,n,o){const i=this.graph.getChildren(o);if(console.log("DFS: children of",o,i),!i.length)return void(o!==e.id&&this.graph.setEdge(e.id,o,{weight:0,minLen:t}));const h=this.addBorderNode("_bt"),a=this.addBorderNode("_bb");this.graph.setParent(h,o),this.graph.borderTop=h,this.graph.setParent(a,o),this.graph.borderBottom=a;this.dfs;i.forEach(i=>{this.dfs(e,t,s,r,n,i);const d=i.borderTop?i.borderTop:i,l=i.borderBottom?i.borderBottom:i,c=i.borderTop?s:2*s,g=d!==l?1:r-n[o]+1;this.graph.setEdge(h,d,{weight:c,minLen:g,nestingEdge:!0}),this.graph.setEdge(l,a,{weight:c,minLen:g,nestingEdge:!0})}),this.graph.parent(o)||this.graph.setEdge(e,h,{weight:0,minLen:r+n[o]})}addBorderNode(e,t,s){const r={width:0,height:0};return t&&s&&(r.rank=t,r.order=s),this.addDummyNode("border",r,e)}addDummyNode(e,t,s){return t.dummy=e,this.graph.setNode(s,t),s}rank(){switch(this.graph.ranker){case"network-simplex":this.networkSimplexRanker();break;case"tight-tree":this.tightTreeRanker();break;case"longest-path":this.longestPathRanker();break;default:this.networkSimplexRanker();break}}position(){this.positionY()}positionX(){this.buildLayerMatrix()}positionY(){const e=this.buildLayerMatrix();console.log("layering",e);const t=this.graph.rankSep;let s=0;e.forEach(e=>{const r=Math.max(e.map(e=>{return e.height}));console.log("maxHeight of nodes layer",r),e.forEach(e=>{e.y=s+r/2}),s+=r+t})}buildLayerMatrix(){const e=[];return this.graph.nodes.forEach(t=>{console.log("creating layer with node",t,t.rank),t.rank&&(e[t.rank]||(e[t.rank]=[]),e[t.rank][t.order]=t)}),e}networkSimplexRanker(){this.longestPath(),this.feasibleTree()}longestPath(){const e=this,t={};function s(r){if(t[r.id])return r.rank;t[r.id]=!0;const n=Math.min(...e.graph.outEdges(r).map(e=>{return s(e.to)-e.minLen})),o=n===1/0?0:n;return r.rank=o}this.graph.sources.forEach(s)}feasibleTree(){this.treeGraph=new p({directed:!1});const e=this.graph.nodeIds[0],t=this.graph.nodeIds.length;let s,r;this.treeGraph.setNode(e),console.log("start is",e,"size is",t);let n=0;while(this.tightTree()<t)if(s=this.findMinSlackEdge(),r=this.treeGraph.hasNode(s.from.id)?this.slack(s):-this.slack(s),this.shiftRanks(r),n++,n>200)throw new Error("too many loops, breaking now!")}tightTree(){const e=this;function t(s){console.log("nodeEdges",e.graph.nodeEdges(s)),e.graph.nodeEdges(s).forEach(r=>{console.log("nodeEdge for",s.id,r);const n=s.id===r.from.id?r.to:r.from;console.log("not hasNode",!e.treeGraph.hasNode(n.id),"not slack",!e.slack(r)),e.treeGraph.hasNode(n.id)||e.slack(r)||(console.log("adding node to tighttree",n),e.treeGraph.setNode(n.id),e.treeGraph.setEdge(s.id,n.id),t(n))})}return this.treeGraph.nodes.forEach(t),console.log("tightTree size is",this.treeGraph.nodeIds.length),this.treeGraph.nodeIds.length}findMinSlackEdge(){let e,t=1/0;return console.log("finding min slack edge"),this.graph.edges.forEach(s=>{if(this.treeGraph.hasNode(s.from.id)!==this.treeGraph.hasNode(s.to.id)){const r=this.slack(s);r<t&&(e=s,t=r)}}),e}slack(e){return console.log("calculating slack of",e,e.to.rank,e.from.rank,e.minLen),e.to.rank-e.from.rank-e.minLen}order(){this.maxRank();console.log("STOPPED HERE, code further!")}maxRank(){this.graph.nodes.reduce((e,t)=>{return t.rank>e?t.rank:e},-1/0)}shiftRanks(e){this.treeGraph.nodes.forEach(t=>{t.rank+=e})}translateGraph(){let e=1/0,t=0,s=1/0,r=0;const n=this.graph.marginX||0,o=this.graph.marginY||0;function i(n){const o=n.x,i=n.y,h=n.width,a=n.height;e=Math.min(e,o-h/2),t=Math.max(t,o+h/2),s=Math.min(s,i-a/2),r=Math.max(r,i+a/2)}this.graph.nodes.forEach(i),this.graph.edges.forEach(e=>{e.x&&i(e)}),e-=n,s-=o,this.graph.nodes.forEach(t=>{t.x-=e,t.y-=s}),this.graph.edges.forEach(t=>{t.points.forEach(t=>{t.x-=e,t.y-=s}),t.x&&(t.x-=e),t.y&&(t.y-=s)}),this.graph.width=t-e+n,this.graph.height=r-s+o}}const g="\0";class p{constructor({directed:e=!0,multiGraph:t=!1,compound:s=!1,rankDir:r="TB",rankSep:n=50,edgeSep:o=20,nodeSep:i=50,marginX:h=20,marginY:a=20}){Object.assign(this,{directed:e,multiGraph:t,compound:s,rankDir:r,rankSep:n,edgeSep:o,nodeSep:i,marginX:h,marginY:a}),this._nodes={},this._edges={},!0===this.compound&&(this.parent={},this.children={},this.children[g]={}),this.root=null,this.in={},this.preds={},this.out={},this.sucs={}}setNode(e,t){return this._nodes[e]?(t&&this._nodes[e].setOptions(t),this._nodes[e]):(console.log("creating node",e,t),this._nodes[e]=new i(e,t),!0===this.compound&&(this.parent[e]=g,this.children[e]={},this.children[g][e]=!0),this.in[e]={},this.preds[e]={},this.out[e]={},this.sucs[e]={},this._nodes[e])}removeNode(e){console.log("TODO: removing not finished"),this._nodes[e]&&(delete this._nodes[e],this.compound&&(delete this.parent[e],delete this.children[e]),delete this.in[e],delete this.preds[e],delete this.out[e],delete this.sucs[e])}setEdge(e,t,s){console.log("setting edge",e,t,s);const r=l.generateId(e,t,this.directed);if(this._edges[r])return s&&this._edges[r].setOptions(s),this;const n=this.setNode(e),o=this.setNode(t),i=new l(r,n,o,s);return this._edges[r]=i,this.out[e][r]=i,this.in[t][r]=i,this}removeEdge(e){if(console.log("TODO: removing not finished"),!this.edges[e])return;const t=this._edges[e];delete this.in[t.from],delete this.out[t.to],delete this._edges[e]}getNode(e){return this._nodes[e]}getChildren(e){if(e||(e=g),!this.compound)return e===g?this.nodes:[];{const t=this.children[e];if(t)return Object.keys(t)}}setParent(e,t){if(!this.compound)throw new Error("Cannot set parent in a non-compound graph");if(t){for(let s=parent;!s;s=this.parent(s))if(s===e)throw new Error("Setting "+t+" as parent of "+e+" would create a cycle");this.setNode(t)}else t=g;this.setNode(e),delete this.children[t][e],this.parent[e]=t,this.children[t][e]=!0}nodeEdges(e,t){const s=this.inEdges(e,t);if(s)return s.concat(this.outEdges(e,t))}isSubgraph(e){return 0!==this.getChildren(e).length}layout(){console.log("layouting graph");new c(this)}hasNode(e){return this._nodes[e]}get nodes(){return Object.values(this._nodes)}get edges(){return Object.values(this._edges)}get sources(){return this.nodes.filter(e=>{return 0===Object.keys(this.in[e.id]).length})}inEdges(e,t){let s=this.in[e.id];if(!s)return;const r=Object.values(s);return t?r.filter(e=>e.from.id===t.id):r}outEdges(e,t){let s=this.out[e.id];if(!s)return;const r=Object.values(s);return t?r.filter(e=>e.to.id===t.id):r}get nodeIds(){return Object.keys(this._nodes)}}class u{constructor(e){this.node=document.createElementNS("http://www.w3.org/2000/svg",e)}append(e){return e instanceof u||(e=new u(e)),this.node.appendChild(e.node),e}attr(e,t){return this.node.setAttribute(e,t),this}select(e){const t=this.node.querySelector(e);return t?new u(t):null}selectAll(e){const t=this.node.querySelectorAll(e);return t?Array.from(t).map(e=>new u(e)):null}text(e){const t=document.createTextNode(e);return this.node.appendChild(t),this}addClass(e){return this.node.classList.add(e),this}}class f{constructor(e,t,s){this.shape=this[e](t,s),console.log("inside bbox",this.shape.node.getBBox())}rect(e,t){return console.log("bbox",e),new u("rect").attr("rx",t.rx).attr("ry",t.ry).attr("x",-e.width/2).attr("y",-e.height/2).attr("width",e.width).attr("height",e.height).attr("rx",t.rx)}}class m{constructor(e){this.group=new u("g"),this.labelData=e,this.textLabel()}textLabel(){this.group.append("text").text(this.labelData.label)}}class w{constructor(e){this.graph=e}render(e){console.log("rendering",e,this.graph);this.createOrSelectGroup(e,"edgePaths"),this.createEdgeLabels(this.createOrSelectGroup(e,"edgeLabels"),this.graph);this.createNodes(this.createOrSelectGroup(e,"nodes")),this.graph.layout();let t=1e3,s=1e3,r=-1e3,n=-1e3;this.graph.nodes.forEach(e=>{t=Math.min(t,e.x-e.width/2),s=Math.min(s,e.y-e.height/2),r=Math.max(r,e.x+e.width/2),n=Math.max(n,e.y+e.height/2)}),this.graph.edges.forEach(e=>{e.label&&e.x&&e.y&&(t=Math.min(t,e.x-e.width/2),s=Math.min(s,e.y-e.height/2),r=Math.max(r,e.x+e.width/2),n=Math.max(n,e.y+e.height/2));const o=e.points.slice(1,e.points.length-1);for(let i=0;i<o.length;i++){const e=o[i];t=Math.min(t,e.x),s=Math.min(s,e.y),r=Math.max(r,e.x),n=Math.max(n,e.y)}}),this.graph.minX=t,this.graph.minY=s,this.graph.maxX=r,this.graph.maxY=n,console.log("GRAPH",this.graph),this.positionNodes()}createNodes(e){this.graph.nodeIds.filter(e=>{return!this.graph.isSubgraph(e)});this.graph.nodes.forEach(t=>{const s=e.append("g").addClass("node"),r=s.append("g").addClass("label"),n=r.append(new m({label:t.label}).group),o=n.node.getBBox();o.width+=t.paddingLeft+t.paddingRight,o.height+=t.paddingTop+t.paddingBottom,r.attr("transform","translate("+(t.paddingLeft-t.paddingRight)/2+","+(t.paddingTop-t.paddingBottom)/2+")");const i=s.append(new f(t.shape,o,t).shape),h=i.node.getBBox();t.width=h.width,t.height=h.height,s.append(r),t.svgGroup=s})}createLabel(e){}createEdgeLabels(e,t){e.selectAll("g.edgeLabel");this.graph.edges.forEach(t=>{const s=e.append("g").addClass("edgeLabel"),r=s.append("g").addClass("label"),n=r.append(new m({label:t.label}).group),o=n.node.getBBox();t.width=t.width||o.width,t.height=t.height||o.height})}positionNodes(){console.log("position nodes",this.graph.nodes,"with edges",this.graph.edges),this.graph.nodes.forEach(e=>{e.svgGroup.attr("transform","translate("+e.x+","+e.y+")")})}createOrSelectGroup(e,t){return e.select("g."+t)||e.append("g").addClass(t)}}class b{constructor(e,t){this.id=e,this.options=t,this.edges=[]}leadsTo(e,t){return this.edges.push({otherId:e.id,options:t}),e}}class E{constructor(e){this.elements=[]}addElement(e,t){const s=new b(e,t);return this.elements.push(s),s}render(e){const t=new u("svg");t.node.id="f"+e.id,e.appendChild(t.node);const s=t.append("g"),r=new p({multiGraph:!0,compound:!0,rankDir:"LR",marginX:20,marginY:20});for(const o in this.elements){const e=this.elements[o];r.setNode(e.id,e.options)}for(const o of r.nodes)o.rx=o.ry=5;for(const o in this.elements){const e=this.elements[o];for(const t in e.edges){const s=e.edges[t];r.setEdge(e.id,s.otherId,s.options)}}const n=new w(r);n.render(s)}}var x={name:"VueFlowy",props:{chart:{type:E,required:!0}},data(){return{chartElement:null}},watch:{"chart.elements":function(e,t){this.chart.render(this.chartElement)}},mounted(){this.chartElement=document.getElementById(this._uid)}},y=x;s("E1aB");function k(e,t,s,r,n,o,i,h){var a,d="function"===typeof e?e.options:e;if(t&&(d.render=t,d.staticRenderFns=s,d._compiled=!0),r&&(d.functional=!0),o&&(d._scopeId="data-v-"+o),i?(a=function(e){e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,e||"undefined"===typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),n&&n.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(i)},d._ssrRegister=a):n&&(a=h?function(){n.call(this,this.$root.$options.shadowRoot)}:n),a)if(d.functional){d._injectStyles=a;var l=d.render;d.render=function(e,t){return a.call(t),l(e,t)}}else{var c=d.beforeCreate;d.beforeCreate=c?[].concat(c,a):[a]}return{exports:e,options:d}}var _=k(y,r,n,!1,null,null,null),v=_.exports;const N={install:e=>{e.component(v.name,v)}};v.install=N.install;var O={VueFlowy:v,FlowChart:E};t["default"]=O},E1aB:function(e,t,s){"use strict";var r=s("yF/8"),n=s.n(r);n.a},HrLf:function(e,t,s){if("undefined"!==typeof window){let e;(e=window.document.currentScript)&&(e=e.src.match(/(.+\/)[^/]+\.js$/))&&(s.p=e[1])}},"yF/8":function(e,t,s){}})["default"]});
//# sourceMappingURL=vue-flowy.umd.min.js.map