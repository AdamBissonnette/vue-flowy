(function(e,t){"object"===typeof exports&&"object"===typeof module?module.exports=t():"function"===typeof define&&define.amd?define([],t):"object"===typeof exports?exports["vue-flowy"]=t():e["vue-flowy"]=t()})(window,function(){return function(e){var t={};function s(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,s),o.l=!0,o.exports}return s.m=e,s.c=t,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},s.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s="+xUi")}({"+xUi":function(e,t,s){"use strict";s.r(t);s("HrLf");var n=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"flowyChart",attrs:{id:e._uid}})},o=[];const r={paddingLeft:10,paddingRight:10,paddingTop:10,paddingBottom:10,rx:0,ry:0,shape:"rect",width:0,height:0};class i{constructor(e,t){this.id=e,this.setOptions(t)}setOptions(e={}){e.label||(e.label=this.id),Object.assign(this,r,e)}setDefaults(){}}const h="\0",a="",d={minLen:1,weight:1,width:0,height:0,labelOffset:10,labelPos:"r"};class l{constructor(e,t,s,n){this.id=e,this.from=t,this.to=s,this.setOptions(n)}static generateId(e,t,s=!1){if(!s&&e>t){const s=e;e=t,t=s}return e+a+t+a+h}setOptions(e){Object.assign(this,d,e)}}class c{constructor(e){this.graph=e,this.runLayout(),console.log("new layout for graph",e)}runLayout(){this.makeSpaceForEdgeLabels(),this.createNestingGraph(),this.rank(),this.cleanupNestingGraph(),this.position()}makeSpaceForEdgeLabels(){this.graph.rankSep/=2,console.log(this.graph),this.graph.edges.forEach(e=>{console.log("making space for edge",e),e.minLen*=2,"c"!==e.labelPos.toLowerCase()&&("TB"===this.graph.rankDir||"BT"===this.graph.rankDir?e.width+=e.labelOffset:e.height+=e.labelOffset)})}createNestingGraph(){console.log("creating nesting graph"),this.graph.root=this.graph.setNode("_root",{dummy:"root"});const e=this.treeDepths();console.log("depths",e);const t=Math.max(...Object.values(e))-1,s=2*t+1;this.graph.edges.forEach(e=>{e.minLen*=s});const n=this.graph.edges.reduce((e,t)=>e+t.weight,0);this.graph.getChildren().forEach(o=>{this.dfs(this.graph.root,s,n,t,e,o)}),this.graph.nodeRankFactor=s}cleanupNestingGraph(){this.graph.removeNode(this.graph.root.id),this.graph.root=null,this.graph.edges.forEach(e=>{e.nestingEdge&&this.graph.removeEdge(e.id)})}treeDepths(){const e={},t=this;function s(n,o=1){const r=t.graph.getChildren(n.id);r&&r.length&&r.forEach(e=>{s(e,o+1)}),e[n.id]=o}return this.graph.getChildren().forEach(s),e}dfs(e,t,s,n,o,r){const i=this.graph.getChildren(r.id);console.log("children of",r,i),i.length?console.log("not returning, patcher: code further!"):r.id!==e.id&&this.graph.setEdge(e.id,r.id,{weight:0,minLen:t})}rank(){switch(this.graph.ranker){case"network-simplex":this.networkSimplexRanker();break;case"tight-tree":this.tightTreeRanker();break;case"longest-path":this.longestPathRanker();break;default:this.networkSimplexRanker();break}}position(){this.positionY()}positionX(){this.buildLayerMatrix()}positionY(){const e=this.buildLayerMatrix();console.log("layering",e);const t=this.graph.rankSep;let s=0;e.forEach(e=>{const n=Math.max(e.map(e=>{return e.height}));console.log("maxHeight of nodes layer",n),e.forEach(e=>{e.y=s+n/2}),s+=n+t})}buildLayerMatrix(){const e=[];return this.graph.nodes.forEach(t=>{t.rank&&(e[t.rank]||(e[t.rank]=[]),e[t.rank][t.order]=t)}),e}networkSimplexRanker(){this.longestPath(),this.feasibleTree()}longestPath(){const e=this,t={};function s(n){if(console.log("visting node",n),t[n.id])return n.rank;t[n.id]=!0;const o=Math.min(e.graph.outEdges(n).map(e=>{return s(e.to)-e.minLen}))||0;return n.rank=o}console.log("sources",this.graph.sources),this.graph.sources.forEach(s)}feasibleTree(){this.treeGraph=new p({directed:!1});const e=this.graph.nodeIds[0],t=this.graph.nodeIds.length;let s,n;this.treeGraph.setNode(e),console.log("size is",t);let o=0;while(this.tightTree()<t)if(console.log("LOOP STARTS"),s=this.findMinSlackEdge(),console.log("minslackedge is",s),n=this.treeGraph.hasNode(s.from.id)?this.slack(s):-this.slack(s),this.shiftRanks(n),o++,o>200)throw new Error("too many loops, breaking now!")}tightTree(){const e=this;function t(s){e.graph.nodeEdges(s).forEach(n=>{console.log("CHECKING EDGE",n);const o=s.id===n.from.id?n.to:n.from;e.treeGraph.hasNode(o.id)||e.slack(n)||(console.log("ADDING NODE TO TIGHTTREE"),e.treeGraph.setNode(o.id),e.treeGraph.setEdge(s.id,o.id),t(o))})}return this.treeGraph.nodes.forEach(t),console.log("tightTree size is",this.treeGraph.nodeIds.length),this.treeGraph.nodeIds.length}findMinSlackEdge(){let e,t=1/0;return console.log("finding min slack edge"),this.graph.edges.forEach(s=>{if(this.treeGraph.hasNode(s.from.id)!==this.treeGraph.hasNode(s.to.id)){const n=this.slack(s);n<t&&(e=s,t=n)}}),e}slack(e){return console.log("calculating slack of",e.to.rank,e.from.rank,e.minLen,e.to.rank-e.from.rank),e.to.rank-e.from.rank-e.minLen}shiftRanks(e){this.treeGraph.nodes.forEach(t=>{t.rank+=e})}}const g="\0";class p{constructor({directed:e=!0,multiGraph:t=!1,compound:s=!1,rankDir:n="TB",rankSep:o=50,edgeSep:r=20,nodeSep:i=50,marginX:h=20,marginY:a=20}){this._nodes={},this._edges={},!0===this.compound&&(this.parent={},this.children={},this.children[g]={}),this.root=null,this.in={},this.preds={},this.out={},this.sucs={},this.edgeObjs={}}setNode(e,t){return this._nodes[e]?(t&&this._nodes[e].setOptions(t),this._nodes[e]):(console.log("creating node",e,t),this._nodes[e]=new i(e,t),!0===this.compound&&(this.parent[e]=g,this.children[e]={},this.children[g][e]=!0),this.in[e]={},this.preds[e]={},this.out[e]={},this.sucs[e]={},this._nodes[e])}removeNode(e){console.log("TODO: removing not finished"),this._nodes[e]&&(delete this._nodes[e],this.compound&&(delete this.parent[e],delete this.children[e]),delete this.in[e],delete this.preds[e],delete this.out[e],delete this.sucs[e])}setEdge(e,t,s){console.log("setting edge",e,t,s);const n=l.generateId(e,t,this.directed);if(this._edges[n])return s&&this._edges[n].setOptions(s),this;const o=this.setNode(e),r=this.setNode(t),i=new l(n,o,r,s);return this._edges[n]=i,this.out[e][n]=i,this.in[t][n]=i,this}removeEdge(e){if(console.log("TODO: removing not finished"),!this.edges[e])return;const t=this._edges[e];delete this.in[t.from],delete this.out[t.to],delete this._edges[e]}getNode(e){return this._nodes[e]}getChildren(e){if(e||(e=g),!this.compound)return e===g?this.nodes:[];{const t=this.children[e];if(t)return Object.keys(t)}}nodeEdges(e,t){const s=this.inEdges(e,t);if(s)return s.concat(this.outEdges(e,t))}isSubgraph(e){return 0!==this.getChildren(e).length}layout(){console.log("layouting graph");new c(this)}hasNode(e){return this._nodes[e]}get nodes(){return Object.values(this._nodes)}get edges(){return Object.values(this._edges)}get sources(){return this.nodes.filter(e=>{return 0===Object.keys(this.in[e.id]).length})}inEdges(e,t){let s=this.in[e.id];if(!s)return;const n=Object.values(s);return t?n.filter(e=>e.from.id===t.id):n}outEdges(e,t){let s=this.out[e.id];if(!s)return;const n=Object.values(s);return t?n.filter(e=>e.to.id===t.id):n}get nodeIds(){return Object.keys(this._nodes)}}class u{constructor(e){this.node=document.createElementNS("http://www.w3.org/2000/svg",e)}append(e){return e instanceof u||(e=new u(e)),this.node.appendChild(e.node),e}attr(e,t){return this.node.setAttribute(e,t),this}select(e){const t=this.node.querySelector(e);return t?new u(t):null}selectAll(e){const t=this.node.querySelectorAll(e);return t?Array.from(t).map(e=>new u(e)):null}text(e){const t=document.createTextNode(e);return this.node.appendChild(t),this}addClass(e){return this.node.classList.add(e),this}}class f{constructor(e,t,s){this.shape=this[e](t,s),console.log("inside bbox",this.shape.node.getBBox())}rect(e,t){return console.log("bbox",e),new u("rect").attr("rx",t.rx).attr("ry",t.ry).attr("x",-e.width/2).attr("y",-e.height/2).attr("width",e.width).attr("height",e.height).attr("rx",t.rx)}}class m{constructor(e){this.group=new u("g"),this.labelData=e,this.textLabel()}textLabel(){this.group.append("text").text(this.labelData.label)}}class b{constructor(e){this.graph=e}render(e){this.createOrSelectGroup(e,"edgePaths"),this.createEdgeLabels(this.createOrSelectGroup(e,"edgeLabels"),this.graph);this.createNodes(this.createOrSelectGroup(e,"nodes")),this.graph.layout(),this.positionNodes()}createNodes(e){console.log("createNodes selection is",e,"graph is",this.graph);this.graph.nodeIds.filter(e=>{return!this.graph.isSubgraph(e)});this.graph.nodes.forEach(t=>{const s=e.append("g").addClass("node");console.log("adding node",t);const n=s.append("g").addClass("label"),o=n.append(new m({label:t.label}).group),r=o.node.getBBox();console.log("label",o,"labelGroup",n),r.width+=t.paddingLeft+t.paddingRight,r.height+=t.paddingTop+t.paddingBottom,n.attr("transform","translate("+(t.paddingLeft-t.paddingRight)/2+","+(t.paddingTop-t.paddingBottom)/2+")");const i=s.append(new f(t.shape,r,t).shape),h=i.node.getBBox();t.width=h.width,t.height=h.height,s.append(n),t.svgGroup=s})}createLabel(e){}createEdgeLabels(e,t){let s=e.selectAll("g.edgeLabel");console.log(s),s.forEach(e=>{const t=SvgGenerator.create("g");t.classList.add("edgeLabel"),e.classList.add("update"),e.appendChild(t)})}positionNodes(){console.log("position nodes",this.graph.nodes,"with edges",this.graph.edges),this.graph.nodes.forEach(e=>{e.svgGroup.attr("transform","translate("+e.x+","+e.y+")")})}createOrSelectGroup(e,t){return e.select("g."+t)||e.append("g").addClass(t)}}class w{constructor(e,t){this.id=e,this.options=t,this.edges=[]}leadsTo(e,t){return this.edges.push({otherId:e.id,options:t}),e}}class E{constructor(e){this.elements=[]}addElement(e,t){const s=new w(e,t);return this.elements.push(s),s}render(e){const t=new u("svg");t.node.id="f"+e.id,e.appendChild(t.node);const s=t.append("g"),n=new p({multiGraph:!0,compound:!0,rankDir:"LR",marginX:20,marginY:20});for(const r in this.elements){const e=this.elements[r];n.setNode(e.id,e.options)}for(const r of n.nodes)r.rx=r.ry=5;for(const r in this.elements){const e=this.elements[r];for(const t in e.edges){const s=e.edges[t];n.setEdge(e.id,s.otherId,s.options)}}const o=new b(n);o.render(s)}}var k={name:"VueFlowy",props:{chart:{type:E,required:!0}},data(){return{chartElement:null}},watch:{"chart.elements":function(e,t){this.chart.render(this.chartElement)}},mounted(){this.chartElement=document.getElementById(this._uid)}},y=k;s("E1aB");function _(e,t,s,n,o,r,i,h){var a,d="function"===typeof e?e.options:e;if(t&&(d.render=t,d.staticRenderFns=s,d._compiled=!0),n&&(d.functional=!0),r&&(d._scopeId="data-v-"+r),i?(a=function(e){e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,e||"undefined"===typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),o&&o.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(i)},d._ssrRegister=a):o&&(a=h?function(){o.call(this,this.$root.$options.shadowRoot)}:o),a)if(d.functional){d._injectStyles=a;var l=d.render;d.render=function(e,t){return a.call(t),l(e,t)}}else{var c=d.beforeCreate;d.beforeCreate=c?[].concat(c,a):[a]}return{exports:e,options:d}}var x=_(y,n,o,!1,null,null,null),v=x.exports;const O={install:e=>{e.component(v.name,v)}};v.install=O.install;var L={VueFlowy:v,FlowChart:E};t["default"]=L},E1aB:function(e,t,s){"use strict";var n=s("yF/8"),o=s.n(n);o.a},HrLf:function(e,t,s){if("undefined"!==typeof window){let e;(e=window.document.currentScript)&&(e=e.src.match(/(.+\/)[^/]+\.js$/))&&(s.p=e[1])}},"yF/8":function(e,t,s){}})["default"]});
//# sourceMappingURL=vue-flowy.umd.min.js.map